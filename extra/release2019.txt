Patient Sumamry time line contoller:
1.Create Patient Summary record while Assessment and Nursing Record and OT Checklist creation 
2.Now write all the reuqired  params for that time line event 
3.Find all the patient summary timeline record by the patient
4.Write Feature specs for Nursing Record and OTChecklist and Assessment spec 


admission: [{ displayname: "Admission", templatename: "admission" },{ displayname: "Assessment", templatename: "assessment" }{ displayname: "Care Plan", templatename: "careplan" }]

operative: [{ displayname: "OT Checklist", templatename: "otchecklist" },{ displayname: "Operative", templatename: "operative" },{ displayname: "Sedation Chart", templatename: "sedation"}]

discharge: [{ displayname: "Aldrete Score", templatename: "aldrete" },{ displayname: "Pain Assessment", templatename: "painassessment" },{ displayname: "Discharge", templatename: "discharge" }]


admissiontemplate: { templateid: 281685003, displayname: "Admission Form", snomedcode: 281685003, snomedname: "Admission for care", js: [], erb: [] }

assessmentemplate: { templateid: 315639002, displayname: "Assessment Form", snomedcode: 315639002, snomedname: "Initial Patient Assessment ", js: [], erb: [] }

careplantemplate: { templateid: 734163000, displayname: "Nursing Care Plan Documentation", snomedcode: 734163000, snomedname: "Care Plan", js: [], erb: [] }

operativetemplate: { templateid: 257556004, displayname: "Operative", snomedcode: 257556004, snomedname: "Surgery", js: [], erb: [] } 

sedationtemplate: { templateid: 72641008, displayname: "SEDATION / ANALGESIA MONITORING CHART", snomedcode: 72641008, snomedname: "Sedation", js: [], erb: [] } 

aldretetemplate: { templateid: 448226000, displayname: "MODIFIED ALDRETE SCORE FOR DISCHARGE", snomedcode: 448226000, snomedname: "Modified Aldrete score", js: [], erb: [] } 

painassessmenttemplate: { templateid: 225399009, displayname: "Pain Assessment", snomedcode: 225399009, snomedname: "Pain Assessment", js: [], erb: [] }

dischargetemplate: { templateid: 75823008, displayname: "Discharge Form", snomedcode: 75823008, snomedname: "Discharge", js: [], erb: [] }

otchecklisttemplate: { templateid: 111111111, displayname: "OT Checklist", snomedcode: 111111111, snomedname: "Surgery Checklist", js: [], erb: [] } 


{ displayname: "Admission Note", templatename: "admissionnote" }, { displayname: "OT Note", templatename: "operativenote" }, { displayname: "Discharge Note", templatename: "dischargenote" },


Admission           32485007  Hospital admission
Assessment          315639002  Initial patient assessment   
OT Checklist        111111111  Surgery Checklist
Operative           448826009  Brief Operative Note
Discharge           373942005   Discharge summary  
Pain Assessment     225399009  Pain assessment 
Sedation Chart      72641008   Sedation  
Care Plan           734163000  Care plan
Aldrete Score       448226000  Modified Aldrete score
Ward Note           225746001  Ward


tempaltetype : pain, sedation , Aldrete Score , care Plan 

PAIN ASSESSMENT TEMPLATE
SEDATION TEMPLATE
ALDRETE TEMPLATE
CARE PLAN TEMPLATE


In Old template Changes 
New Change and features 

Final testing Issues / Task pending 
1.Add OT Checklist Date in OTChecklist in new and Old migration data   Done 
2.Facility ID and Organisation id for Patient Assessment  Done 
3.Patient Assesmment Edit ID wala logic 
4.Change OT Checklist name form OT Checklist to Surgical Checklist 
5.Horizontal line in nurisng records Done 
6.Put new IP
6.Mongo Queries Data 


Learning 
how to take snapshot of database 
how to change the DB on AWS 
Why we use ids as mongo bson id not string 

Problems with 
1.OT Checklist and Nursing print method and patient assessment in specs 
2.Ot Checklist in new and edit in specs not 

Final Questions
1.List out all the data model names 
2.OT Checklist Snomed ID "11111111"

1.Nursing Record Model : admission_id , facility_id, organisation_id,patient_id,template_id,templatetype,
2.OtChecklist Model : admission_id , facility_id, organisation_id,patient_id,template_id,templatetype
3.PatientAssessment : admission_id, patient_id 

OT Checklist Model Name Change  
OT Checklist for Ortho missing field 
All form should be there in Ortho or not 
OT Checklist View is not there only edit and update.

Rakes for IPD Refactor :
updating IPD Notes Template Ids 
Update Assesment template IDs and Facility and Organisation IDs rakes
OT Checklist Creation from Old Ot Notes 

#Migration for updating procedure ot_checklist_id = nil
Inpatient::IpdRecord.update_all(is_migrated:false)
Inpatient::IpdRecord.where(is_migrated:false).each do |ipd,i|
  if ipd.procedure.count > 0
    ipd.procedure.each do |pro|
      pro.update(ot_checklist_id:nil,ot_checklist:false)
    end
  end
  ipd.update(is_migrated:true)
end


db.patient_assessments.update({},{ $unset: {'template_id':1'}},false, true)

final issues in IPD refactor 
1.date and timepicker read only and with white color  Done 
2.Button alignment for small devices = Done      
3.Created Date in patient Summary time line = Done 


Needs to work now 
1.We need to show time as created at time or give extra field  Done 
2.We need to give text box for Nurse Name or take that current User only or Store last updated user id and Name and role Done 
3.Do I need to create Record Histories for these notes also Done 
4.Do I need to Show these notes in all notes 



@all_nursing_records = NursingRecord.where(admission_id:@admission.id)
@assessment = PatientAssessment.where(admission_id:@admission.id)
NursingRecord.where(:fullname.exists:true).last
Needs to work now  final work 
1.Add Record Histories is patient Assessment - Done 
2.Add Commented nursing record print code in all summary and all note print  Done   
3.Need to update migration in trello list in our documents and new features updated  
4.Text field for patient Received by Done
5.Text field for payment at date and time  Done  
6.Other notes only length > 0  
7.Add Assessment Record history migration - I am not writing migration for patient assessment because first I dont have user id who created that assessment and second It won't create problem You can not open show page with out updating that assessment even summary also you need to update once.So It's ok if we dont write migration.  

Weekend
1.Hackerearth Last test Questions and try New contest
2.Testing full of Ipd Work
3.New features
4.Download 2 open source project and set and find the way to run
5.Set Test data base for My laptop 
6.Mongo commands group by and see Analytics Command logics 


Demo 


db.nursing_records.update({},{$rename:{'sedation.signature':'sedation.name'}}, false, true);

NursingRecord.where(templatetype:"sedation").each_with_index do |pos,i|
 if pos.sedation.count > 0
  pos.sedation.each do |sed|
    puts i
    sed.update(name:sed.signature)
  end
 end
   
https://stackoverflow.com/questions/51285207/mongodb-how-to-remove-field-from-element-in-nested-array

IPD Demo Test
1.Remove notes for Ortho or not  Done
2.update signature to name in notes Done
3.Add yml update Done
4.For Pain Form Face Images Done 
5.Remove Aldrete score for Ortho template Done  
6.Procedures Text in OT-Checklist  Done 
7.Add taper and Eye options in Medicine
8.Font Size in pain assessment  


Rest 
2.Font Size not coming properly in pdf and print side 
3.Remove Discharge Summary in all notes 
10.Stepper for Pain Assessment 
11.In Aldrete score text given selected options with their score 
12.Save Medication Kit Functionality  

1.Save Medication Button need to hide for today release 
2.Addd Stepper for Pain Assessment form
3.In Aldrete Scroe give selected Options 
4.FontSize and Remove Quantity from Ortho Print  

Rest
1.Frequncy not updating some time in pain and careplan notes  : Done 
2.Add Language setting in care plan and pain: Done
3.Ortho Medication set test : Done 
4.Medication Collumn Percentage : 
5.Mail and print button in removed : Done 
6.Ortho Meidcation edit language setting : Done
7.Print medication according to language : Done
8.Keep Date time in One collumn in Medicine print: Done
9.Before Language and after language font same  
10.Remove Qty collumn in medicine ortho:  Done 


Monday Work 
1.Ortho Language Medication Set   Done
2.Ortho Discharge note Record Histories =  Done 
3.Ortho Medicine Dropdown change =  Done
5.Width while adding set of medicine duration and duration unit =   Done
8.Add Ortho ka frequnecy full array every where = Done 
9.Change Language instruction condition =  Done 
6.In Ortho Discharge Medicine extra text box and selected drop-down both there = Done
7.Inventory code and print setting code lookup tuesday 
4.Write Specs
5.OpdDrop down condition : Done


5.Code Review and Testing all IPD Code Refactor Code 
https://www.facebook.com/SocioHubVideo/videos/295583831031055/  

Final 
1.Patient Final score should be in Aldrete Score print : 
4.Decission on index making : 
5.Rakes Review and list 
6.Medicine and note creation time zone testing



Contacts : 
City 
State 
Pincode: 


contacts/_form.html.erb
contacts/_edit.html.erb
contacts/_new.html.erb



Huzaifa:
/home/max/Hgraph/hg_ehr_product/lib/tasks/migration/update_old_casesheets_medics.rake  Anoop  VImp
/home/max/Hgraph/hg_ehr_product/lib/tasks/migration/old_casesheets_medics.rake  old 
/home/max/Hgraph/hg_ehr_product/lib/tasks/migration/old_casesheets_medics_vlr.rake user


/home/max/Hgraph/hg_ehr_product/lib/tasks/migration/update_new_feature.rake old  
/home/max/Hgraph/hg_ehr_product/lib/tasks/migration/facility_contact.rake    

/home/max/Hgraph/hg_ehr_product/lib/tasks/migration/service_pricing_master.rake keep 
/home/max/Hgraph/hg_ehr_product/lib/tasks/migration/service_master_export.rake keep

/home/max/Hgraph/hg_ehr_product/lib/tasks/migration/move_redis_local.rake   A


update diagnosis where select option is not there 
1.either update children code name and children 
2.






IcdDiagnosis.find_by(code:"t542").update(childrencodename: [["toxic effects of corrosive acids and acid like substances","t542x"]])

#<IcdDiagnosis _id: 5b5df3ef2c1b503ee2e1c095, created_at: 2018-07-29 17:05:51 UTC, updated_at: 2018-12-28 13:15:11 UTC, specialty_id: nil, template_id: nil, code: "t542", shortcode: "t542", separated_code: "t54|2", codelength: 4, abbrevated_name: "toxic effects of corrosive acids and acid like substances", fullname: "toxic effects of corrosive acids and acid like substances", originalname: "Toxic effects of corrosive acids and acid-like substances", shortname: "toxic effects of corrosive acids and acid like substances", root: 0, has_parent: false, parentcodename: [], parentfullinfo: [], has_children: true, childrenfullinfo: [{"5":["t542x", "toxic effects of corrosive acids and acid like substances", "toxic effects of corrosive acids and acid like substances", ""]}], childrencodename: [["toxic effects of corrosive acids and acid like substances", "t542x"]], has_laterality: false, laterality_position: "", lateralitylabel: "", children_has_laterality: false, laterality_filter: [], originatingcodes: [["Toxic effect of corrosive substances", "t54"]]>



 #<IcdDiagnosis _id: 5b5df3ef2c1b503ee2e1c095, created_at: 2018-07-29 17:05:51 UTC, updated_at: 2018-07-29 17:05:51 UTC, specialty_id: nil, template_id: nil, code: "t542", shortcode: "t542", separated_code: "t54|2", codelength: 4, abbrevated_name: "toxic effects of corrosive acids and acid like substances", fullname: "toxic effects of corrosive acids and acid like substances", originalname: "Toxic effects of corrosive acids and acid-like substances", shortname: "toxic effects of corrosive acids and acid like substances", root: 0, has_parent: false, parentcodename: [], parentfullinfo: [], has_children: true, childrenfullinfo: [{"5":["t542x", "toxic effects of corrosive acids and acid like substances", "toxic effects of corrosive acids and acid like substances", ""]}], childrencodename: [["", "t542x"]], has_laterality: false, laterality_position: "", lateralitylabel: "", children_has_laterality: false, laterality_filter: [], originatingcodes: [["Toxic effect of corrosive substances", "t54"]]>



1.Monday 
A.Diangosis
B.New feature update discussion
C.If you see the clone time is not updating in history

Wednesday
1.Discharge Model for Discharge Date and Time
2.Remove Delete Url from Old button 
3.Local Testing Whole IPD and OtherWork  Which needs to be release
3
app/views/patient_summary_timelines/event_links/full_view/_admission.html.erb
app/views/inpatients/admission/admission_details/_admission_actions.html.erb
app/views/ipd_patients/_eachadmissioncontrols.html
app/views/ipd_patients/_updatedischargeform.html.erb
/inpatient/home/admission_management/_admission_details.html

<%= link_to inpatient_new_path(patient_id: @patient.id.to_s,admission_id: @admission.id.to_s), id: "assessment-note-btn", class: "btn btn-primary btn-primary-transparent btn-xs assessment_note", :data : {:remote : true, 'toggle' :  "modal", 'target' : '#assessment-modal'} do %> Assessment <% end %>

<%= link_to ipd_patients_discharge_path(:admission_id : @admission.id, :patient_id : @admission.patient.id, current_date: @current_date),class: "btn btn-danger btn-xs pull-right", :data : {:remote : true, 'toggle' :  "modal", 'target' : '#discharge-modal'} do %> Discharge Patient<% end %>


 <%= form_tag "/ip_patients/discharge", method: "post", remote: true, html: { class: "discharge-form" } do %>


 <%= form_tag "/ipd_patients/discharge", method: "post", remote: true, html: { class: "discharge-form" } do %>

Analytics Issues :
pharmacy and Optical total collection should be same new and Old collection
Average Time Taken by Doctor unit should be Hours i think
All investigations count is there but no ophthal and Laboratory and Radiology Investigation count zero.
Overall Organisation Rating 2 digit float number at all places 
On Hover Average Rating not coming
Patient Referral Y axis text not coming properly
Timetaken by optometrist 2 digit float
AgeWise Ophthal Investigation in clinical changing in opthal investigation same graph reflecting
Glasses Prescription and Ophthal investigation should not be there in Ortho Overview

Error production
1.Ipd Error: app/controllers/patient_summary_timelines_controller.rb:202:in `get_content_query'
For Given Admission_is not Inpatient::IpdRecord there 



Inpatient::IpdRecord.each_with_index do |ipd,i|
  if ipd.clinical_note.present?
    if ipd.clinical_note.selected_opdrecord_id.present? || ipd.clinical_note.preexisting_problems || ipd.clinical_note.procedure_planned
      puts i
    end
  end
end


1. How to add medication sets at organisation level

2. How to do dilation

Send with headings.

A.For Add Medication sets at organisation level
1.Click On User Icon
2.Click on Organisation Settings 
3.Click on Clinical Section and Scroll down
4.Find "Organisation Medication Sets" 
5.Click on Mediction Set 
6.Select OPD, IPD or All according to your requirements
6.Search Medicine by name and fill other details
7.Click on Add Medication Set
8.Now Below Save Medication select Organisation 

B.Dialtion
1.Click on Dialte Button 
2.Fill all the details Dialting User,Drop Name and comment
3.Click on Start Dialtion button
4.If you want to stop dilation then click on stop button



A. Adding Medication sets at organisation level
1. Click On User Icon
2. Click on Organisation Settings 
3. Click on Clinical Section and Scroll down
4. Find "Organisation Medication Sets" 
5. Click on Mediction Set 
6. Select OPD, IPD or All according to your requirements
6. Search Medicine by name and fill other details
7. Click on Add Medication Set
8. Now Below Save Medication select Organisation 

Working branches  all tested code : ajit branch 
                 : user_address_changes : small bugs fixes 
                 : ipd_refactor_ajit : Ipd New Tempaltes 
from ajit branhc : ipd_structure_refactor : Ipd Templates common partial work 
                 : production-direct : Appointment type bug
 

Testing Sceanrio:
1.New Notes Added Care plan and Sedation chart and Pain Template and Aldrete Template 
2.Ot Checklist should not be in Operative note 
3.Alderete Score should be there in Opthal only not ortho
4.For Patient Assessment also patient summary should be there 
5.Test create and Update all nursing and other IPD old templates 
6.Also create and View and Print all nursing templates form summary
7.Add Medication Set from Settings and find in nursing templates 
8.Add Medication set form nurisng pain and care plan templates 
9.Create OT and also create notes from there also 
10.Organisation Contact and Facilit contact city state Drop Down Search 

Small Bug fixes:
1.Ortho Edit Medication set instruction drop down coming now
2.On Ortho discharge note On language change medicine coming according to opthal fix now
3.Remove Qty in Ortho medication summary print
4.Print all notes email and print button bug fix
5.Record Histories in Orthos discharge notes
6.Medication instruction bugs fixes in whole project 
7.Migration for special status
8.Discharge Confirmation dialog at the time of dicscharge
9.Enable new feature so while we do release we need to this thing
10.Some diagnosis not able to save becaues select option was not there 
11.Put Sepearatefolders for Migrations


Rake list : 
# Inpatient::IpdRecord.update_all(is_migrated: false)
# PatientAssessment.update_all(is_migrated:false)
# bundle exec rake ipd_migration:create RAILS_ENV=preproduction  2 hours 40 minutes
# bundle exec rake ipd_migration:admission_update RAILS_ENV=preproduction - 3 minutes 
# bundle exec rake ipd_migration:update RAILS_ENV=preproduction  25-30  minutes 

User Address Changes Branch rakes 
# bundle exec rake icd_diagnosis_children_update:update_icd RAILS_ENV=preproduction
# bundle exec rake update_special_status:update RAILS_ENV=preproduction

On every Release
User.update_seen


Advise Set in Ortho Operative Note 
1.Orhto :   ap Inpatient::IpdRecord.find_by(admission_id:"5c2ee8052c1b500ed9671cd5").operative_notes.last
2.Ophthal : ap Inpatient::IpdRecord.find_by(admission_id:"5c32f2742c1b500d10bcc874").operative_notes.last

Redis 
Simpleform
cocoon
Sidekiq
Error Handling
Kaafakha
Devise 

Operative note
Wardnote 
Clinical note
Discharge note 
OtChecklist 

db.inpatient_ipd_records.updateMany({},{ $rename: { "discharge_note.templateid": "discharge_note.template_id","clinical_note.templateid": "clinical_note.template_id" } })

db.nursing_records.updateMany({},{$rename: {"templateid": "template_id","templatetype": "template_type"}})

db.ot_checklists.updateMany({},{$rename: {"templateid": "template_id","templatetype": "template_type"}})

Reason for  discharge in admission 
Reason for Dischare in Admission in Ortho Note

1.Write test Scenarios 
2.Certify the release
3.Add New Features Notes 
6.Update New Features 


1.New Features in Release : Done 
2.Discharge Data open  : Done 
4.Close button c small =  Done
5.Patient Assessment Patient_id type = String  Done 
5.Margin and padding in Pain and care plan notes = Done  
6.Put condition over date for br tag = Done
9.Discharge pahle cancel bad me  = Done  
8.Remove Validation for Facility contacts  City State Search Done 
9.Adv. Date or time in Medications  Done
7.Hide the  default time 


Batman V28.0  
Release Date : 15/01/2018

Upcoming Release Details:- 
1. New IPD template Added Care Plan, Sedation Chart, Aldrete Score and Pain Assessment
2. OT Checklist separated from Operative note
3. Organization Contact and Facility contact city-state Drop Down Search
4. Medication set for Ward
5. Ability to change Discharge Date/Time at the time of Discharging the patient.
6. Small bug fixes

Thanks
Ajit Jain

Healthgraph

ipd_structure_refactor branch common partails 
1.Common Partial for IPD Records:
2.Not changing at controller

Admission Notes are same  
Clinical Some files are same
Ward Notes are same 
 
Discharge note some files are same  
Operative Notes are Note Same

1.Sedation form are same for  
2.Aldrete Form Only Ophthal Done 
3.OtChecklistmodel.html.erb : At 2 location Speciality condition
4.Care plan form : at Time of medication partail 
5.Pain Assessment form : at time of medication partail
6.Patient Assessment : Form same for Opthal and Ortho
7.Admission Note : Are all form common now 
8.Ward note formbody in common partials : Fortim being nothing common
9.Clinical Notes : Patient General History Specicality condition  Done 
10.Operative Notes are same 
11.Discharge only checklists  are same 
12.

Bugs :
1.Patient Assessment was not cominging Orhto Clincal note 
2.Complain Date note coming in Ortho at Edit Admission Form
3.In Clinicl Note Admin : payment type and admission reason from ortho
4.In ortho Surgery timezone not there 
5.Advice Set Language not able to change 
 

Tasks 
1.Run User.update Seen Release Notes
2.Ask to Huzi to update Puts i or note



db.inpatient_ipd_records.find( {operative_notes : {$exists:true}, $where:'this.operative_notes.length>2'} ).count()

db.inpatient_ipd_records.find( {'operative_notes.complication': 'No'} ).count()

db.inpatient_ipd_records.find({'operative_notes.complication': {$exists: true}});

db.inpatient_ipd_records.find( {operative_notes : {$exists:true}, $where:'this.operative_notes.length>0'} ).count()

Verification after work 
1.Sedation form are same for  
2.Aldrete Form Only Ophthal Done 
3.OtChecklistmodel.html.erb : At 2 location Speciality condition
4.Care plan form : at Time of medication partail 
5.Pain Assessment form : at time of medication partail
6.Patient Assessment : Form same for Opthal and Ortho
7.Admission Note : All Same only form body from Speciality folder
8.Clinical Note : 
  A.Admin and History partials ars same coming from common, 
  B.Clinical Note : condition in prodcedures search, only for ophthal 
  C.Caseclinical details ophthal investigation field extra
9.Operative Note
  A.Personnel tab same and Complications same 
  B.In Surgery Ortho Surgery Date not in Opthal 
  C.Surgery having Speciality condition for preoperative diagnosis
  D.In Opthal avise set also coming from predefined sets 
  E.Operative Summary are different in ophthal and Ortho
10.Discharge Note 
  A.Checklist Same
  B.Discharge Details content Different in Diagnosis and procedure 
  C.In Advice medicine is there so it will be seperate form 
  D.Advice Details having conditions on medications, button Actions and procedures

<div class="col-md-3 col-sm-3" style="padding: 0px">
  <div class="col-md-12 col-sm-12 badge badge-eye-template-labels"><strong>PGP&nbsp;&nbsp;</strong><i class="fa fa-arrow-right rcopybutton" title="Copy Left to Right" aria-hidden="true"></i></div>
</div>

<div class="col-md-12 col-sm-12 badge badge-eye-template-labels"><strong>PGP&nbsp;&nbsp;</strong><i class="fa fa-arrow-right rcopybutton" title="Copy Left to Right" aria-hidden="true"></i></div>

<div class="col-md-3 col-sm-3" style="padding: 0px">
  <div class="col-md-12 col-sm-12 badge badge-eye-template-labels"><strong>KERATOMETRY&nbsp;&nbsp;</strong><i class="fa fa-arrow-left lcopybutton" title="Copy Right to Left" aria-hidden="true"></i></div>
</div>
  
<div class="col-md-12 col-sm-12 badge badge-eye-template-labels"><strong>KERATOMETRY&nbsp;&nbsp;</strong><i class="fa fa-arrow-left lcopybutton" title="Copy Right to Left" aria-hidden="true"></i></div>

<div class="col-md-12 col-sm-12 badge badge-eye-template-labels data-filled"><strong>AUTO REFRACTION&nbsp;&nbsp;</strong><i class="fa fa-arrow-right rcopybutton" title="Copy Left to Right" aria-hidden="true"></i></div>

<div class="col-md-12 col-sm-12 badge badge-eye-template-labels data-filled"><strong>AUTO REFRACTION&nbsp;&nbsp;</strong><i class="fa fa-arrow-left lcopybutton" title="Copy Right to Left" aria-hidden="true"></i></div>


Now Task That I need to complete
1.Add extra instruction for Time interval
2.For Tapering extra coloumn for Interval 
3.Add Info for underastanding instructioons
4.Add Summer note in Examination every where
5.Test for all template
6.Copy Refraction from Left to Right and Right to Left


1.Test all the Features
2.Create Document for Print Settings

Print Settings Discussions:
1.Print Setting Model
  A.When Organisation create one common print setting will create
  B.



Files Needs to Changes
/home/max/Hgraph/hg_ehr_product/app/views/settings/admindoctors/_reload_setting_option.html.erb
/home/max/Hgraph/hg_ehr_product/app/views/settings/admindoctors/_reload_setting_print_preview.html.erb
/home/max/Hgraph/hg_ehr_product/app/views/settings/admindoctors/reload_print_setting.js.erb

for Facilty and Department list
/home/max/Hgraph/hg_ehr_product/app/views/sub_referral_types/_new_sub_referral.html.erb

Do We need to give print option to Doctor or not

Inpatient::IpdRecord.where('procedure.case_sheet_procedure_id':nil).count
OpdRecord.where('chief_complaints.duration_unit': "year")



counter = 0
Inpatient::IpdRecord.all.each do |ipd_record|
 ipd_record.procedure.each do |procedure|
   unless procedure.case_sheet_procedure_id.present?
     procedure.update(case_sheet_procedure_id: ipd_record.case_sheet_id)
     counter += 1
   end
 end
end
puts counter


bundle exec rake update_casesheet_id:ipdrecord RAILS_ENV=production (3 minutes at preproduction)

<%= taper["interval"].to_i > 0 ? pluralize(taper["interval"], 'hour') : '-'  %>

Steps 
1.Create Print Setting Model
2.Show the list of all Facility
3.Show the list of all deparmtnet for facility
4.How to manage to show list of selected and not selected and select all and zero select validation logic copy paste
5.How to handle Department settings work.
 

 https://stackoverflow.com/questions/2196382/rails-select-tag-with-multiple-values-pre-selected

Owner Doctor Admin


Print Settings Code Reading
1.


Try to put a common class 
def update_print_settings
    @organisation = current_user.organisation
    @default_setting = PrintSetting.find_by(organisation_id: @organisation.try(:id),type:"default")
    @print_settings = PrintSetting.where(organisation_id: @organisation.try(:id))  
    respond_to do |format|
      format.js{ render "settings/admindoctors/update_print_settings", layout: false }
      format.html {}
    end 
  end


// $('#opdrecord_r_trauma_comment').summernote(summernote_options)
// $('#opdrecord_r_appearance_comments').summernote(summernote_options)
// $('#opdrecord_r_appendages_comments').summernote(summernote_options)
// $('#opdrecord_r_conjunctiva_comments').summernote(summernote_options)
// $('#opdrecord_r_cornea_comments').summernote(summernote_options)
// $('#opdrecord_r_pupil_comments').summernote(summernote_options)
// $('#opdrecord_r_anteriorchamber_comments').summernote(summernote_options)
// $('#opdrecord_r_iris_comments').summernote(summernote_options)
// $('#opdrecord_r_lens_comments').summernote(summernote_options)
// $('#opdrecord_r_extraocularmovements_comments').summernote(summernote_options)
// $('#opdrecord_r_iop_comments').summernote(summernote_options)
// $('#opdrecord_r_gonioscopy_comment').summernote(summernote_options)
// $('#opdrecord_r_fundus_comments').summernote(summernote_options)

// $('#opdrecord_l_trauma_comment').summernote(summernote_options)
// $('#opdrecord_l_appearance_comments').summernote(summernote_options)
// $('#opdrecord_l_appendages_comments').summernote(summernote_options)
// $('#opdrecord_l_conjunctiva_comments').summernote(summernote_options)
// $('#opdrecord_l_cornea_comments').summernote(summernote_options)
// $('#opdrecord_l_pupil_comments').summernote(summernote_options)
// $('#opdrecord_l_anteriorchamber_comments').summernote(summernote_options)
// $('#opdrecord_l_iris_comments').summernote(summernote_options)
// $('#opdrecord_l_lens_comments').summernote(summernote_options)
// $('#opdrecord_l_extraocularmovements_comments').summernote(summernote_options)
// $('#opdrecord_l_iop_comments').summernote(summernote_options)
// $('#opdrecord_l_gonioscopy_comment').summernote(summernote_options)
// $('#opdrecord_l_fundus_comments').summernote(summernote_options)

// //for Quick eye summernote classess
// $('#opdrecord_r_eyelids_comments').summernote(summernote_options)
// $('#r_conjunctiva_comments_quickeye').summernote(summernote_options)
// $('#opdrecord_r_corneaquick_comments').summernote(summernote_options)
// $('#opdrecord_r_sclera_comments').summernote(summernote_options)
// $('#opdrecord_r_pupilquick_comments').summernote(summernote_options)
// $('#opdrecord_r_lensquick_comments').summernote(summernote_options)
// $('#opdrecord_r_vitreousquick_comments').summernote(summernote_options)

// $('#opdrecord_r_fundusquick_comments').summernote(summernote_options)
// $('#opdrecord_r_opticdiscquick_comments').summernote(summernote_options)
// $('#opdrecord_r_maculaquick_comments').summernote(summernote_options)
// $('#opdrecord_r_peripheralretinaquick_comments').summernote(summernote_options)
// $('#opdrecord_r_tonometry_comments').summernote(summernote_options)
// $('#opdrecord_r_gonioscopy_comments').summernote(summernote_options)
// $('#opdrecord_r_schirmers_comments').summernote(summernote_options)
// $('#opdrecord_r_lacrimalpatency_comments').summernote(summernote_options)
// $('#opdrecord_r_squint_comments').summernote(summernote_options)
// $('#opdrecord_r_motorevaluation_comments').summernote(summernote_options)
// $('#r_anteriorchamber_comments_quickeye').summernote(summernote_options)

// $('#opdrecord_l_eyelids_comments').summernote(summernote_options)
// $('#l_conjunctiva_comments_quickeye').summernote(summernote_options)
// $('#opdrecord_l_corneaquick_comments').summernote(summernote_options)
// $('#opdrecord_l_sclera_comments').summernote(summernote_options)
// $('#opdrecord_l_pupilquick_comments').summernote(summernote_options)
// $('#opdrecord_l_lensquick_comments').summernote(summernote_options)
// $('#opdrecord_l_vitreousquick_comments').summernote(summernote_options)
// $('#opdrecord_l_fundusquick_comments').summernote(summernote_options)
// $('#opdrecord_l_opticdiscquick_comments').summernote(summernote_options)
// $('#opdrecord_l_maculaquick_comments').summernote(summernote_options)
// $('#opdrecord_l_peripheralretinaquick_comments').summernote(summernote_options)
// $('#opdrecord_l_tonometry_comments').summernote(summernote_options)
// $('#opdrecord_l_gonioscopy_comments').summernote(summernote_options)
// $('#opdrecord_l_schirmers_comments').summernote(summernote_options)
// $('#opdrecord_l_lacrimalpatency_comments').summernote(summernote_options)
// $('#opdrecord_l_squint_comments').summernote(summernote_options)
// $('#opdrecord_l_motorevaluation_comments').summernote(summernote_options)
// $('#l_anteriorchamber_comments_quickeye').summernote(summernote_options)  


sidebar-doctor-filter-letterhead

doctors_list

Print Setting model
id
name
facility_ids
department_ids
organisation_id
type = all, normal
fields
while

updated
header_height
footer_height
left_margin 
right_margin

logo_location
header_location
right
left
header
cutomised_letter_head
customised_footer
footer_text
 
header_height: "3",footer_height: "2",left_margin: "1",right_margin: "1",logo_location: "",header_location: "",right: "",left: "",header: "",customised_letter_head: true,customised_footer: true,footer_text: '',updated: false

all_print_setting = {header_height: "3",footer_height: "2",left_margin: "1",right_margin: "1",logo_location: "",header_location: "",right: "",left: "",header: "",customised_letter_head: true,customised_footer: true,footer_text: '',updated: false}

FacilitySetting.create(facility_id: facility.id, user_sms_feature: user_setting_hash, sms_feature: true, facility_name: facility.name, all_print_setting: all_print_setting, opd_print_setting: opd_print_setting, ipd_print_setting: ipd_print_setting, pharmacy_print_setting: pharmacy_print_setting, optical_print_setting: optical_print_setting, laboratory_print_setting: laboratory_print_setting, radiology_print_setting: radiology_print_setting, ophthalmology_print_setting: ophthalmology_print_setting, invoice_print_setting: invoice_print_setting)



PrintSetting.create(organisation_id:"58b6b43a6c55d3b8a5400a1e",name:"Non Workflow",header_height:2,footer_height:2,left_margin:2,right_margin:1,logo_location:"",header_location:"",right:"",left:"",header:"",
customised_letter_head: true,customised_footer: true,footer_text: '',facility_ids:[BSON::ObjectId('58b6b4626c55d3b8a5400a22'),
 BSON::ObjectId('58b6b4686c55d3b8a5400a23'),
 BSON::ObjectId('5b51a9fc2c1b503762b63cb4'),
 BSON::ObjectId('5b55c0702c1b5073289622a6')],department_ids: ["309988001", "284748001", "50121007", "261904005", "309964003", "450368792"],type:'all')

 sidebar-doctor-filter-letterhead

 sidebar-print-letterhead


https://www.youtube.com/watch?v=qFzVbU_xUlM

/home/max/Hgraph/hg_ehr_product/app/views/sub_referral_types/_new.html.erb



https://www.livemint.com/


<%= taper["interval"].to_i > 0 ? 'Every '+ pluralize(taper["interval"], 'hour') : '-'  %>

every for interval


1.Print all data submission
2.


 <%= select_tag "commonly_used_diagnosis", options_for_select(list, @selected_diagnosis), class: 'form-control commonly_used_diagnosis_list' %>

 {"organisation_id":"58b6b43a6c55d3b8a5400a1e", "name":"", "letter_head_height":"", "footer_height":"", "left_margin":"", "right_margin":"", "customised_letter_head":"false", "header_location":"left", "header_text":"<br>", "header_logo_location":"left", "left_header_text":"<br>", "right_header_text":"<br>", "customised_footer":"false", "footer_text":"<br>"}

 Steps:
 1.Change Create and Update success logic
 2.create common function for organisation find and Print Settings.all
 3.Good way or single function for hitting again active on edit and new and create and update
 4.Print Preview according to new logic


Captain Cold V29.0  
Release Date: 29/01/2019(Tuesday Morning)

Upcoming Release Details:- 
1. Copy Refraction data from left to right and vice versa
2. Multiline comment boxes for OPD template Examination 
3. Time Interval instructions in Tapering (For Ex. Every 2 hours)

Thanks
Ajit Jain

Healthgraph



if params[:customised_letter_head] == 'true'
      @print_setting[:customised_letter_head] = true
      @print_setting[:updated] = eval(params[:updated])
      @print_setting[:logo_location] = params[:header_logo_location]
      @print_setting[:header_location] = params[:header_location]
      if params[:header_logo_location] == 'left'
        @print_setting[:right] = params[:right_header_text]
      elsif params[:header_logo_location] == 'right'
        @print_setting[:left] = params[:left_header_text]
      elsif params[:header_logo_location] == 'none'
        @print_setting[:left] = params[:left_header_text]
        @print_setting[:right] = params[:right_header_text]
      end
      if params[:header_location] == 'left'
        @print_setting[:header] = params[:header_text]
      elsif params[:header_location] == 'right'
        @print_setting[:header] = params[:header_text]
      elsif params[:header_location] == 'center'
        @print_setting[:header] = params[:header_text]
      end
    end
    @print_setting[:header_height] = params[:letter_head_height]
    @print_setting[:footer_height] = params[:footer_height]
    @print_setting[:left_margin] = params[:left_margin]
    @print_setting[:right_margin] = params[:right_margin]
    @print_setting[:customised_footer] = eval(params[:customised_footer])
    @print_setting[:footer_text] = params[:footer_text]

footer_height
header_height
left_margin
right_margin
customised_letter_head
customised_footer
footer_text
header_location : left right center
header_text
header_logo_location : Left, Right , None ===== Left/right

Need to ask anoop about style none


new file:   app/views/layouts/pdf-footer2.html.erb
new file:   app/views/layouts/pdf-header2.html.erb
new file:   app/views/print/_print_header2.html.erb

1.Validation for the form and Notification
2.Correct Small difference in print and Preview
3.Select all and Delselect all feature
4.By Default Organisation Image for Print Setting

Hello Team,


// $('#print_customisations_form').on('click', function(e){
//   e.preventDefault();   
//   print_setting_form_validate()    
// })


Regarding my work :
Hello Team,

All my worked already released.

Last work is Print setting Changes.

Branch Name : print_settings_changes

Model: print_setting.rb
Controller: print_settings_controller
View: print_settings

Docuemnt for Print Setting: https://drive.google.com/drive/u/0/folders/1vcrQhOp03NpN4iB2GpgwNueYW7NXASM6 

Whenever An Organisation will create

1.Create A default Setting Print Setting for Organisation While An Organisation will create with type default/all == 4 hours
2.Write Migration for All Other Orgnanisations  6 hours
3.Test OPD Template Prints With Drop down Options     

After That Remove old Code for Print setting like default print settings and others  



1.Click on Patient Summary button
2.Right Bottom in Patient Details find Certificates
3.Click on Free Meidcal Certificates
4.

1.Name of Default setting
2.Access of print setting
3.Default Setting shoule be editable or Not
4.Decission on Types and Name of Default Setting
5.Remove Old Code and Old Print Settings
6.





{"utf8":"✓", "authenticity_token":"uKdGyu/+9pEhGk+4lC/uSNtavUHbbc9Wpq+ju8OPah94Pqz+rroPtV3IB0EvO2lV3fYGz1hbdYGRH8TaIFcRPA==", "user":{"_id":"5c5038522c1b500f0d220f01", "integration_identifier":"5c5038522c1b500f0d220f02", "age":"18", "user_selected_url":"/outpatients/appointment_management", "fullname":"ww", "email":"ww@gmail.com", "username":"wwwww", "gender":"Female", "dob":"16/01/2001", "role_ids":"160943002", "department_id":"309988001"}, "facility":{"integration_identifier":"5c5038522c1b500f0d220f03", "clinical_workflow":"false", "country_id":"IN_108", "time_zone":"Asia/Kolkata", "currency_symbol":"₹", "currency_id":"INR001"}, "organisation":{"integration_identifier":"5c5038522c1b500f0d220f04", "type":"hospital", "type_id":"22232009", "account_counter":"290120191", "account_expiry_date":"28/02/2019", "onboarding_completed":"true", "letter_head_customisations":{"header_height":"3", "footer_height":"0", "left_margin":"1", "right_margin":"1", "logo_location":"left", "header_location":"left", "right":"<br>", "header":"<br>"}, "setup_type":"single_user", "name":"www", "tagline":"www", "pincode":"232104", "state":"UTTAR PRADESH", "city":"Varanasi", "address1":"1", "address2":"1", "telephone":"1111111111", "fax":"", "website":"", "terms":"1", "acceptancy_name":"", "acceptance_date":"04:56 PM, 29 Jan 2019", "referral_code":"218OPH11012"}, "referral_code":"218OPH11012", "commit":"SIGN UP & PROCEED"}



{
  "utf8": "\u2713",
  "authenticity_token": "uKdGyu\/+9pEhGk+4lC\/uSNtavUHbbc9Wpq+ju8OPah94Pqz+rroPtV3IB0EvO2lV3fYGz1hbdYGRH8TaIFcRPA==",
  "user": {
    "_id": "5c5038522c1b500f0d220f01",
    "integration_identifier": "5c5038522c1b500f0d220f02",
    "age": "18",
    "user_selected_url": "\/outpatients\/appointment_management",
    "fullname": "ww",
    "email": "ww@gmail.com",
    "username": "wwwww",
    "gender": "Female",
    "dob": "16\/01\/2001",
    "role_ids": "160943002",
    "department_id": "309988001"
  },
  "facility": {
    "integration_identifier": "5c5038522c1b500f0d220f03",
    "clinical_workflow": "false",
    "country_id": "IN_108",
    "time_zone": "Asia\/Kolkata",
    "currency_symbol": "\u20b9",
    "currency_id": "INR001"
  },
  "organisation": {
    "integration_identifier": "5c5038522c1b500f0d220f04",
    "type": "hospital",
    "type_id": "22232009",
    "account_counter": "290120191",
    "account_expiry_date": "28\/02\/2019",
    "onboarding_completed": "true",
    "letter_head_customisations": {
      "header_height": "3",
      "footer_height": "0",
      "left_margin": "1",
      "right_margin": "1",
      "logo_location": "left",
      "header_location": "left",
      "right": "<br>",
      "header": "<br>"
    },
    "setup_type": "single_user",
    "name": "www",
    "tagline": "www",
    "pincode": "232104",
    "state": "UTTAR PRADESH",
    "city": "Varanasi",
    "address1": "1",
    "address2": "1",
    "telephone": "1111111111",
    "fax": "",
    "website": "",
    "terms": "1",
    "acceptancy_name": "",
    "acceptance_date": "04:56 PM, 29 Jan 2019",
    "referral_code": "218OPH11012"
  },
  "referral_code": "218OPH11012",
  "commit": "SIGN UP & PROCEED"
}



print_setting[:organisation_id] =
print_setting[:] =


@print_setting = PrintSetting.last 
  if @language_flag == 'true'
    respond_to do |format|
      # format.html {render "templates/#{@specalityfoldername}/print/opd_summary_print", :layout => "print"}
      format.pdf {render :template => "opd_records/#{@specalityfoldername}_notes/download/opd_summary_language_download", :pdf => "#{filename}", :layout => 'pdfgen.html.erb', viewport_size: '1280x1024', :page_size => "A4", :disable_smart_shrinking => true, :show_as_html => params[:debug].present?, :header => {:spacing => 0,:html => {:template => 'layouts/pdf-header2.html'}},:footer => {:html => { :template=>  'layouts/pdf-footer2.html' },:spacing => 10, }, :margin => {left: @print_setting.try(:left_margin).to_f * 10,right: @print_settings.try(:right_margin).to_f * 10,:top=> @print_setting.try(:header_height).to_f * 10, :bottom =>  @print_setting.try(:footer_height).to_f * 10} }
    end
  else
    respond_to do |format|
      # format.html {render "templates/#{@specalityfoldername}/print/opd_summary_print", :layout => "print"}
      format.pdf {render :template => "opd_records/#{@specalityfoldername}_notes/download/opd_summary_download", :pdf => "#{filename}", :layout => 'pdfgen.html.erb', viewport_size: '1280x1024', :page_size => "A4", :disable_smart_shrinking => true, :show_as_html => params[:debug].present?, :header => {:spacing => 0,:html => {:template => 'layouts/pdf-header2.html'}},:footer => {:html => { :template=>  'layouts/pdf-footer2.html' },:spacing => 10, }, :margin => {left: @print_setting.try(:left_margin).to_f * 10,right: @print_setting.try(:right_margin).to_f * 10,:top=> @print_setting.try(:header_height).to_f * 10, :bottom =>  @print_setting.try(:footer_height).to_f * 10} }
    end


    PrintSetting.where(organisation_id:"58b6b43a6c55d3b8a5400a1e",:facility_ids.in => ["58b6b4686c55d3b8a5400a23"],:department.ids.in => ["309988001"])

1.User Acess Rule for print Settings
2.Remove Old Code for Which will be useless after print setting release
3.Condition for header hight or top margin for our consideration for preview and print
4.Testing
5.View Side Changes for Print Setting
6.Changes in Editable Field


Department.pluck(:id)
PrintSetting.where(organisation_id:current_user.organisation.id,:facility_ids.in => [current_facility.id.to_s],:department_ids.in => department_ids).pluck(:name,:id)

Department.pluck(:id)
PrintSetting.where(organisation_id:current_user.organisation.id,{"$or":[{:facility_ids.in => [current_facility.id.to_s],:department_ids.in => department_ids},{type:"default"}]}).pluck(:name,:id)

PrintSetting.where({$or:[{:facility_ids.in => [current_facility.id.to_s],:department_ids.in => department_ids},{type:"default"}]}).pluck(:name,:id)

department_id : 

PrintSetting.where(organisation_id:current_user.organisation.id,"$or":[{:facility_ids.in => [current_facility.id.to_s],:department_ids.in => [current_user.department.id]},{type:"default"}])


CustomIcdDiagnosis.where("$or": [{fullname: /#{Regexp.escape(params[:q])}/i}, {code: /#{Regexp.escape(params[:q])}/i}], :organisation_id => current_user.organisation_id, is_deleted: 'false').limit(50)


Edit Footer 
<div class="row" id="footer-div" style="margin-bottom: 60px; <%= @print_setting.customised_footer ? '' : 'display:none' %>">